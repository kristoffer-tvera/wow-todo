var deferredPrompt,data,pwainstall=document.getElementById("pwainstall");if(window.addEventListener("beforeinstallprompt",function(a){a.preventDefault(),deferredPrompt=a,pwainstall&&(pwainstall.style.display="block")}),pwainstall&&pwainstall.addEventListener("click",function(a){pwainstall.style.display="none",deferredPrompt.prompt(),deferredPrompt.userChoice.then(function(a){deferredPrompt=null})}),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(a){},function(a){})}),LocalStorageAvailable()){var currentData=window.localStorage.getItem("data");data=currentData&&0<currentData.length?JSON.parse(currentData):{characters:[],tasks:[],status:[]}}else data={characters:[],tasks:[],status:[]},alert("No LocalStorage. Saving/persisting will not be possible (this means: When you close this window, all data dissapears");function LocalStorageAvailable(){var a="meme";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(a){return!1}}function GetClassFromId(a){switch(a.toString()){case"0":return{name:"Warrior",color:"#C79C6E",text:"#000000"};case"1":return{name:"Paladin",color:"#F58CBA",text:"#000000"};case"2":return{name:"Hunter",color:"#ABD473",text:"#000000"};case"3":return{name:"Rogue",color:"#FFF569",text:"#000000"};case"4":return{name:"Priest",color:"#FFFFFF",text:"#000000"};case"5":return{name:"Death Knight",color:"#C41F3B",text:"#FFFFFF"};case"6":return{name:"Shaman",color:"#0070DE",text:"#FFFFFF"};case"7":return{name:"Mage",color:"#40C7EB",text:"#000000"};case"8":return{name:"Warlock",color:"#8787ED",text:"#000000"};case"9":return{name:"Monk",color:"#00FF96",text:"#000000"};case"10":return{name:"Druid",color:"#FF7D0A",text:"#000000"};case"11":return{name:"Demon Hunter",color:"#A330C9",text:"#FFFFFF"}}}var addcharform=document.querySelector("#addcharform");function RemoveCharacter(a){for(var t=0;t<data.status.length;t++)data.status[t].splice(a,1);data.characters.splice(a,1)}addcharform&&addcharform.addEventListener("submit",function(a){a.preventDefault();var t=a.target,e=new FormData(t),r=e.get("name"),o=e.get("class");data.characters.push({id:data.characters.length,name:r,class:o});for(var s=0;s<data.status.length;s++)data.status[s].push(!1);t.reset(),$("#addchar").modal("hide")});var addtask=document.querySelector("#addtaskform");function RemoveTask(a){data.tasks.splice(a,1),data.status.splice(a,1)}function ResetCheckboxes(){for(var a=[],t=0;t<data.tasks.length;t++){a[t]=[];for(var e=0;e<data.characters.length;e++)a[t][e]=!1}data.status=a,app.status=a}addtask&&addtask.addEventListener("submit",function(a){a.preventDefault();for(var t=a.target,e=new FormData(t).get("taskname"),r=[],o=0;o<data.characters.length;o++)r.push(!1);data.status.push(r),data.tasks.push(e),t.reset(),$("#addtask").modal("hide")});var updateTimeout,importdataform=document.querySelector("#importdataform");function UpdateLocalStorage(){LocalStorageAvailable()&&(clearTimeout(updateTimeout),updateTimeout=setTimeout(function(){window.localStorage.setItem("data",JSON.stringify(data))},100))}importdataform&&importdataform.addEventListener("submit",function(a){a.preventDefault();var t=a.target.querySelector("textarea").value;if(""!==t&&""!==t.trim())try{data=JSON.parse(t),app.characters=data.characters,app.tasks=data.tasks,app.status=data.status,$("#importdata").modal("hide"),alert("Successfully imported data")}catch(a){alert("Failed during import, data looks invalid")}else alert("no data")}),$("#exportdata").on("shown.bs.modal",function(){var a=document.getElementById("exportdatatextarea");a&&(a.value=JSON.stringify(data))});var app=new Vue({el:"#app",data:{characters:data.characters,tasks:data.tasks,status:data.status},methods:{removeCharacter:function(a){RemoveCharacter(a)},removeTask:function(a){RemoveTask(a)},classColors:function(a){var t=GetClassFromId(a);return"color: "+t.text+"; background-color: "+t.color+";"}},watch:{characters:function(){UpdateLocalStorage()},tasks:function(){UpdateLocalStorage()},status:function(){UpdateLocalStorage()}}}),characterModal=new Vue({el:"#addchar",data:{availableClassIds:[0,1,2,3,4,5,6,7,8,9,10,11]},methods:{getClassFromId:function(a){return GetClassFromId(a)}}});